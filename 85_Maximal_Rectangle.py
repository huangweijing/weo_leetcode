from typing import List

class Solution:

    def __init__(self):
        self.from_left = list[list[int]]()
        self.from_top = list[list[int]]()
        self.width = list[list[int]]()
        self.height = list[list[int]]()
        self.size = list[list[int]]()

    def maximalRectangle(self, matrix: List[List[str]]) -> int:
        self.from_left = [[0] * len(matrix[0]) for i in range(len(matrix))]
        self.from_top = [[0] * len(matrix[0]) for i in range(len(matrix))]
        maximum_size = 0
        for i in range(len(matrix)):
            len_stack = list[int]()
            idx_stack = list[int]()
            for j in range(len(matrix[0])):
                if matrix[i][j] == "0":
                    len_stack.clear()
                    idx_stack.clear()
                    continue
                if i > 0 and matrix[i - 1][j] != "0":
                    self.from_top[i][j] = self.from_top[i - 1][j] + 1
                else:
                    self.from_top[i][j] = 1

                if j > 0 and matrix[i][j - 1] != "0":
                    self.from_left[i][j] = self.from_left[i][j - 1] + 1
                else:
                    self.from_left[i][j] = 1

                putin_idx = j
                while len(len_stack) > 0 and len_stack[-1] >= self.from_top[i][j]:
                    len_stack.pop()
                    putin_idx = idx_stack.pop()
                len_stack.append(self.from_top[i][j])
                idx_stack.append(putin_idx)
                for idx in range(len(len_stack)):
                    size = (j + 1 - idx_stack[idx]) * len_stack[idx]
                    # print(i, j, size)
                    if size > maximum_size:
                        maximum_size = size

        # print(self.height)
        # print(self.width)
        # print(self.from_top)
        # print(self.from_left)
        # print(self.size)
        return maximum_size

m = [["1","1","1","0","0"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","0"]]
# m = [["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"]]
# m = [["1","1","1","1","1"],["1","1","1","1","1"],["1","1","1","1","1"]]
# m = [["1","0","1","0"],["1","0","1","1"],["1","0","1","1"],["1","1","1","1"]]
r = Solution().maximalRectangle(m)
print(r)


